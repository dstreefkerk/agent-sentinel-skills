# environments.json Reference

## Origin

This file is generated using tooling from the [KQLAnalyzer](https://github.com/FalconForceTeam/KQLAnalyzer) project by FalconForce.

## Overview

The `environments.json` file contains KQL table schemas for Microsoft security products. It is generated by parsing official Microsoft documentation repositories.

## Generation

Run the following command to regenerate the file:

```bash
python get_schemas.py > environments.json
```

## Data Sources

The script extracts table schemas from two Microsoft documentation repositories:

### M365 Defender (m365)

- **Repository**: https://github.com/MicrosoftDocs/defender-docs
- **Path**: `defender-docs/defender-xdr/*-table.md`
- **Setup**:
  ```bash
  git clone --depth=1 https://github.com/MicrosoftDocs/defender-docs
  ```

### Microsoft Sentinel (sentinel)

- **Repository**: https://github.com/MicrosoftDocs/azure-reference-other
- **Path**: `azure-reference-other/azure-monitor-ref/tables/*.md`
- **Setup**:
  ```bash
  git clone https://github.com/MicrosoftDocs/azure-reference-other
  cd azure-reference-other
  git checkout 97f4433e37c4a95922407dcc4c3014c4badb6881
  ```

> **Note**: The Sentinel tables require a specific commit to ensure schema consistency.

## File Structure

```json
{
  "m365": {
    "tables": {
      "TableName": {
        "ColumnName": "type",
        ...
      }
    },
    "magic_functions": ["FileProfile", "DeviceFromIP"]
  },
  "sentinel": {
    "tables": { ... },
    "magic_functions": []
  }
}
```

## Supported Column Types

The script normalizes column types to valid KQL types:

| Source Type | KQL Type |
|-------------|----------|
| datetime | datetime |
| string | string |
| int, integer | int |
| long, bigint | long |
| bool, boolean, nullablebool | boolean |
| real, double | real |
| dynamic, object | dynamic |
| guid | guid |
| decimal | decimal |
| timespan | timespan |
| enum, list, array | string |

## Additional Columns

Custom columns not present in the documentation can be added via `additional_columns.json`. These are merged into the generated schemas during processing.
